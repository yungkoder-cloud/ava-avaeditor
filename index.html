
<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Крутой редактор фото</title>
<style>
body { margin:0; padding:0; font-family:Arial,sans-serif; background:#f2f2f2; display:flex; flex-direction:column; align-items:center; }
h1 { text-align:center; margin-top:20px; color:#333; }
#editor-container { position:relative; width:90%; max-width:800px; margin:20px auto; background:#fff; border-radius:12px; overflow:hidden; box-shadow:0 4px 15px rgba(0,0,0,0.1); }
#canvas-container { position:relative; width:100%; padding-top:75%; background:#e6e6e6; }
canvas { position:absolute; top:0; left:0; width:100%; height:100%; }
#controls { display:flex; flex-wrap:wrap; gap:10px; justify-content:center; margin:15px 0; }
#controls input, #controls button { padding:10px 15px; font-size:14px; border-radius:8px; border:none; cursor:pointer; transition:0.2s; }
#controls button:hover, #controls input:hover { opacity:0.9; }
#controls button { background:#007aff; color:#fff; }
#templates { display:flex; justify-content:center; flex-wrap:wrap; gap:10px; margin-bottom:20px; }
#templates img { width:70px; height:70px; object-fit:cover; border:2px solid transparent; border-radius:8px; cursor:pointer; transition:0.2s; }
#templates img:hover { border-color:#007aff; transform:scale(1.1); }
@media(max-width:600px){ #controls { flex-direction:column; align-items:center; } #controls input, #controls button { width:90%; } #templates img { width:60px; height:60px; } }
</style>
</head>
<body>

<h1>Крутой редактор фото</h1>

<div id="editor-container">
  <div id="canvas-container">
    <canvas id="canvas" width="800" height="600"></canvas>
  </div>
</div>

<div id="controls">
  <input type="file" id="upload" accept="image/*">
  <input type="text" id="text-input" placeholder="Введите текст">
  <button id="add-text">Добавить текст</button>
  <button id="download">Скачать PNG</button>
</div>

<h3 style="text-align:center;">Выбор шаблонов</h3>
<div id="templates">
  <img src="templates/frame1.png" data-url="templates/frame1.png">
  <img src="templates/frame2.png" data-url="templates/frame2.png">
  <img src="templates/frame3.png" data-url="templates/frame3.png">
  <img src="templates/frame4.png" data-url="templates/frame4.png">
</div>

<script src="https://cdn.jsdelivr.net/npm/fabric@5.3.0/dist/fabric.min.js"></script>
<script>
const canvas = new fabric.Canvas('canvas',{ preserveObjectStacking:true });
document.getElementById('upload').addEventListener('change',(e)=>{
  const file = e.target.files[0]; if(!file) return;
  const reader = new FileReader();
  reader.onload = (f)=>{
    fabric.Image.fromURL(f.target.result,(img)=>{
      canvas.clear();
      const scaleX = canvas.getWidth()/img.width;
      const scaleY = canvas.getHeight()/img.height;
      const scale = Math.min(scaleX,scaleY,1);
      img.scale(scale);
      img.set({left:canvas.getWidth()/2, top:canvas.getHeight()/2, originX:'center', originY:'center'});
      canvas.add(img).sendToBack(img);
      canvas.renderAll();
    },{crossOrigin:'anonymous'});
  };
  reader.readAsDataURL(file);
});
document.getElementById('add-text').addEventListener('click',()=>{
  const txt = new fabric.Textbox(document.getElementById('text-input').value||'Ваш текст',{
    left:100, top:100, fontSize:32, fill:'#fff', fontWeight:'bold', editable:true
  });
  canvas.add(txt).setActiveObject(txt);
});
document.querySelectorAll('#templates img').forEach(imgEl=>{
  imgEl.addEventListener('click',()=>{
    fabric.Image.fromURL(imgEl.dataset.url,(tpl)=>{
      tpl.scaleToWidth(canvas.getWidth()*0.5);
      tpl.set({left:canvas.getWidth()/2, top:canvas.getHeight()/2, originX:'center', originY:'center'});
      tpl.set({hasControls:true, lockUniScaling:false});
      canvas.add(tpl).setActiveObject(tpl);
    },{crossOrigin:'anonymous'});
  });
});
document.getElementById('download').addEventListener('click',()=>{
  const dataURL = canvas.toDataURL({format:'png', quality:1});
  const link = document.createElement('a'); link.href=dataURL; link.download='photo.png'; link.click();
});
const resizeCanvas = ()=>{
  const container = document.getElementById('canvas-container');
  const width = container.clientWidth;
  const height = width*0.75;
  canvas.setWidth(width); canvas.setHeight(height);
  canvas.renderAll();
};
window.addEventListener('resize', resizeCanvas); resizeCanvas();
</script>

</body>
</html>
